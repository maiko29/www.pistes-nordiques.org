<!DOCTYPE HTML>
<html>
  <head>
	<title>Tilelist-viewer</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<style type="text/css">
html, body {
	width: 100%;
	height: 100%;
	margin: 0;
	font-family:sans-serif;
}
#container{
	height: 100%;
	background-color:#fff;
	overflow:hidden;
	margin:0 10px;
	padding-right:250px; /* The width of the rail */
}
#menu {
	text-align:center;
	height: 100%;
	background-color:#fff;
	width:240px;
	float:left;
	margin-right:-250px;
	font-family:sans-serif;
	font-size: 0.8em;
	overflow:auto;
}
#basicMap {
	background-color:#fff;
	width:100%;
	height: 100%;
	margin-right:-250px;
	float:left;
	font-family:sans-serif;
	font-size: 0.7em;
}
#form {
	background-color:#eee;
}
	</style>
	<script src="../js/OpenLayers-2.12-mod.js" type="text/javascript"></script> 
	<script type="text/javascript">

	var pistesLayer;
	var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
	var toProjection   = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
	
	var styleContext = {
	    getColor: function(feature) {
	        if ( feature.attributes['userpoint'] == 'true' ) {return '#000000'}
	        else {
	            if ( feature.attributes['colour'] ) {
	                return feature.attributes['colour'];
	            } else if ( feature.attributes['color'] ) {
	                return feature.attributes['color'];
	            } else {
	                return '#009480';
	            };
	        };
	   },
	    getOpacity: function(feature) {
	        return 0.9;
	    },
	    getZ: function(feature) {
	        if (feature.attributes['route']) {return 12;}
	        else {return 11;}
	    },
	    /*getGraphic: function(feature) {
	        if (feature.attributes['piste:start'] == 'yes') {
	            return '../pistes-nordiques-backend/pics/Nordic_sign.png';}
	        else {return '';}
	    },*/
	    getWidth: function(feature) {
	        if ( feature.attributes['userpoint'] == 'true' ) {return 1}
	        else {
	            if (feature.attributes['route']) {return 2;}
	            else {return 3;}
	        }
	    },
	    getFillOpacity: function(feature) {
	        if ( feature.attributes['userpoint'] == 'true' ) {return 0.5}
	        else {return 0} 
	    }
	};
	var styleTemplate = {
	    pointRadius: 6, //for routing points
	    strokeColor: "${getColor}", // using context.getColor(feature)
	    strokeOpacity: "${getOpacity}",//0.6,
	    strokeWidth: "${getWidth}",
	    graphicZIndex: "${getZ}",
	    fillColor: '#ffffff',
	    fillOpacity: "${getFillOpacity}"
	};
	var pisteStyle = new OpenLayers.Style(styleTemplate, {context: styleContext});
	var pisteStyles = new OpenLayers.StyleMap({
	        'default': pisteStyle,
	        'select': pisteStyle,
	        'highlight': new OpenLayers.Style({
	            pointRadius: 10, //for routing points
	            strokeWidth: 5,
	            graphicZIndex: 15,
	            strokeOpacity: 0.9
	        })
	});
	
	function init() {
	map_init();
	}
	
	function map_init() {
		var options = {
		  controls: [
			new OpenLayers.Control.Navigation(),
			new OpenLayers.Control.PanZoomBar(),
			new OpenLayers.Control.Attribution()
		  ]
		};
		map = new OpenLayers.Map("basicMap", options);
		var mapnik         = new OpenLayers.Layer.OSM();
		var position       = new OpenLayers.LonLat(6.1,46.4).transform( fromProjection, toProjection);
		var zoom           = 13; 
		
		map.addLayer(mapnik);
		
	    pistesLayer = new OpenLayers.Layer.Vector("Pistes Vector", {
	        strategies: [new OpenLayers.Strategy.BBOX()],
	        styleMap: pisteStyles,
	        protocol: new OpenLayers.Protocol.HTTP({
	                url:"../cgi/osmosis/osmosis_handle.py/",
	                sync: true,
	                format: new OpenLayers.Format.OSM({
	                externalProjection:new OpenLayers.Projection("EPSG:4326"),
	                relationsParsers:{
	                    route: OpenLayers.Format.OSM.routeParser
	                    }
	                    })
	        }),
	        projection: new OpenLayers.Projection("EPSG:4326"),
	        minScale: 20000000000, //12
	        visibility: true,
	        rendererOptions: {yOrdering: true, zIndexing: true} //necessary for graphicZIndex to work
	    });
	    map.addLayer(pistesLayer);
		
		
		map.setCenter(position, zoom );
	}
	</script>
  </head>
<body onload="init();">
	<div id="container">
	<div id="basicMap"></div>
	<div id="menu">
		<div id="form">
		</div>
		<div id="content">
		</div>
	</div>
</div>
</body>
</html>
